<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>상품 올리기</title>
</head>
<body>
    <header>
        <h1><a href="/">홈페이지</a></h1>
        <section>
            <ul>
                <li>{% if session %} {{session.user_id}} <a href='/logout'>로그아웃</a> {% else %}<a href="/login">로그인</a> {% endif %} </li>
                <li>{% if session %} <a href="/mypage">나의 페이지</a> {% else %}<a href="/signin">회원가입</a> {% endif %}</li>
            </ul>
        </section>
    </header>
    <section>
        <div>
            <!-- 🚀 enctype 추가: 파일 업로드 시 필수 -->
            <form>
                <div>
                    <label for="eventName">행사 이름:</label>
                    <input type="text" id="eventName" name="eventName" required>
                </div>
                <div>
                    <label for="startDate">행사 시작일:</label>
                    <input type="text" id="startDate" name="startDate" required>
                </div>
                <div>
                    <label for="endDate">행사 종료일:</label>
                    <input type="text" id="endDate" name="endDate" required>
                </div>
                <div>
                    <label for="location">행사 장소:</label>
                    <input type="text" id="location" name="location" required>
                </div>
                <div>
                    <label for="explain">설 명:</label>
                    <textarea id="explain" name="explain" required></textarea>
                </div>
                <div>
                    <label for="image">이미지 업로드:</label>
                    <input type="file" id="image" name="image" required>
                </div>
                <div>
                    <button type="button" id="submit_button">등록</button>
                </div>
            </form>
        </div>
    </section>
    <footer>

    </footer>
</body>
<script>
    let eventName = document.querySelector('#eventName');
    let startDate = document.querySelector('#startDate');
    let endDate = document.querySelector('#endDate');
    let location = document.querySelector('#location');
    let explain = document.querySelector('#explain');
    let image = document.querySelector('#image');

    function onSubmitHandler(){
        let formData = new FormData();

        formData.set('eventName', eventName.value);
        formData.set('startDate', startDate.value);
        formData.set('endDate', endDate.value);
        formData.set('location', location.value);
        formData.set('explain', explain.value);
        formData.set('image', image.files[0]); //'image' 키이름으로 파일 첨부부

        fetch('/upload/new',{
            mothod:'POST',
            body:formData
        }).then((response) => {
            return response.json();
        }).then((resBody) => {
            console.log('success'), resBody['success'];
            window.location.replace('/')
        }).catch((error) => {
            console.log('[Error]',error);
        });
    }
    
    let submitButton = document.querySelector('#submit_button');
    submitButton.addEventListener('click', onSubmitHandler);
</script>
</html>
