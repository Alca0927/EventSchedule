<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒí’ˆ ì˜¬ë¦¬ê¸°</title>
</head>
<body>
    <header>
        <h1><a href="/">í™ˆí˜ì´ì§€</a></h1>
        <section>
            <ul>
                <li>{% if session %} {{session.user_id}} <a href='/logout'>ë¡œê·¸ì•„ì›ƒ</a> {% else %}<a href="/login">ë¡œê·¸ì¸</a> {% endif %} </li>
                <li>{% if session %} <a href="/mypage">ë‚˜ì˜ í˜ì´ì§€</a> {% else %}<a href="/signin">íšŒì›ê°€ì…</a> {% endif %}</li>
            </ul>
        </section>
    </header>
    <section>
        <div>
            <!-- ğŸš€ enctype ì¶”ê°€: íŒŒì¼ ì—…ë¡œë“œ ì‹œ í•„ìˆ˜ -->
            <form>
                <div>
                    <label for="eventName">í–‰ì‚¬ ì´ë¦„:</label>
                    <input type="text" id="eventName" name="eventName" required>
                </div>
                <div>
                    <label for="startDate">í–‰ì‚¬ ì‹œì‘ì¼:</label>
                    <input type="text" id="startDate" name="startDate" required>
                </div>
                <div>
                    <label for="endDate">í–‰ì‚¬ ì¢…ë£Œì¼:</label>
                    <input type="text" id="endDate" name="endDate" required>
                </div>
                <div>
                    <label for="location">í–‰ì‚¬ ì¥ì†Œ:</label>
                    <input type="text" id="location" name="location" required>
                </div>
                <div>
                    <label for="explain">ì„¤ ëª…:</label>
                    <textarea id="explain" name="explain" required></textarea>
                </div>
                <div>
                    <label for="image">ì´ë¯¸ì§€ ì—…ë¡œë“œ:</label>
                    <input type="file" id="image" name="image" required>
                </div>
                <div>
                    <button type="button" id="submit_button">ë“±ë¡</button>
                </div>
            </form>
        </div>
    </section>
    <footer>

    </footer>
</body>
<script>
    let eventName = document.querySelector('#eventName');
    let startDate = document.querySelector('#startDate');
    let endDate = document.querySelector('#endDate');
    let location = document.querySelector('#location');
    let explain = document.querySelector('#explain');
    let image = document.querySelector('#image');

    function onSubmitHandler(){
        let formData = new FormData();

        formData.set('eventName', eventName.value);
        formData.set('startDate', startDate.value);
        formData.set('endDate', endDate.value);
        formData.set('location', location.value);
        formData.set('explain', explain.value);
        formData.set('image', image.files[0]); //'image' í‚¤ì´ë¦„ìœ¼ë¡œ íŒŒì¼ ì²¨ë¶€ë¶€

        fetch('/upload/new',{
            mothod:'POST',
            body:formData
        }).then((response) => {
            return response.json();
        }).then((resBody) => {
            console.log('success'), resBody['success'];
            window.location.replace('/')
        }).catch((error) => {
            console.log('[Error]',error);
        });
    }
    
    let submitButton = document.querySelector('#submit_button');
    submitButton.addEventListener('click', onSubmitHandler);
</script>
</html>
